<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Chaves</title>
    <link rel="stylesheet" href="./contatos.css" />
</head>

<body>

    <div id="container"></div>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">

        class Input extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    valor: ""
                }
            }
            alterouConteudoInput = (e) => {
                this.setState({
                    valor: e.target.value
                }, () => {
                    this.props.aoAlterar(this.state.valor);
                });
            }
            render() {
                const { classeInput } = this.props;
                return <input type="text" className={classeInput} value={this.state.valor} onChange={this.alterouConteudoInput} />;
            }
        }

        class InputComAcao extends React.Component {
            constructor(props) {
                super(props);
            }
            alterouConteudoInput = (valor) => {
                this.props.aoAlterar(valor);
            }
            clicouNaAcao = () => {
                this.props.aoAcao();
            }
            render() {
                const { classeAcao } = this.props;
                return <div>
                    <Input classeInput={"buscar-contatos"} aoAlterar={this.alterouConteudoInput} />
                    <button
                        type="button"
                        className={classeAcao}
                        onClick={this.clicouNaAcao}
                    ></button></div>;
            }
        }

        class FotoRedonda extends React.Component {
            constructor(props) {
                super(props);
            }
            render() {
                const { caminho } = this.props;
                return <div
                    className="contato-avatar"
                    style={{
                        backgroundImage: `url(${caminho})`
                    }}
                ></div>
            }
        }

        class Lista extends React.Component {
            constructor(props) {
                super(props);
            }
            aoRemoverItem = (id) => {
                this.props.aoRemoverAlgumItem(id); // No exemplo, esta prop é passada por <App />
            }
            render() {
                const { itens } = this.props;
                return <ul>
                    {itens.map(item => <ItemLista key={item.id} id={item.id} foto={item.foto} titulo={item.nome} subtitulo={item.telefone} aoRemover={this.aoRemoverItem} />)}
                </ul>
            }
        }

        class ItemLista extends React.Component {
            constructor(props) {
                super(props);
            }
            invocarCallbackAoRemover = () => {
                this.props.aoRemover(this.props.id); // Estas props são passadas por <Lista />
            }
            render() {
                const { foto, titulo, subtitulo } = this.props;
                return <li className="contato-lista-item">
                    <FotoRedonda caminho={foto} />
                    <div className="contato-detalhes">
                        <p>{titulo}</p>
                        <p>{subtitulo}</p>
                    </div>
                    <button className="contato-remover" onClick={this.invocarCallbackAoRemover}>Remover</button>
                </li>
            }
        }

        class FormularioCadastro extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    nome: "",
                    telefone: "",
                    foto: ""
                }
            }
            alterouNome = (valor) => {
                this.setState({
                    nome: valor
                })
            }
            alterouTelefone = (valor) => {
                this.setState({
                    telefone: valor
                })
            }
            alterouFoto = (valor) => {
                this.setState({
                    foto: valor
                })
            }
            clicouNoVoltar = () => {
                this.props.aoVoltar();
            }
            realizarCadastro = () => {
                this.props.aoCadastrar(Object.assign({}, this.state));
            }
            render() {
                return <div id="cadastro">
                    <form className="criar-contato-form">
                        <h1>Criar novo contato</h1>
                        <label>Nome: </label>
                        <Input aoAlterar={this.alterouNome} />
                        <label>Telefone: </label>
                        <Input aoAlterar={this.alterouTelefone} />
                        <label>Foto: </label>
                        <Input aoAlterar={this.alterouFoto} />
                        <button className="voltar" type="button" onClick={this.clicouNoVoltar}>Voltar</button>
                        <button className="cadastrar" type="button" onClick={this.realizarCadastro}>Cadastrar</button>
                    </form>
                </div>
            }
        }

        class App extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    estaNaListagem: true,
                    filtro: "",
                    personagens: [
                        {
                            id: 1,
                            nome: 'Chaves',
                            telefone: '+52 1234-5671',
                            foto: "./fotos/chaves.jpg"
                        },
                        {
                            id: 2,
                            nome: 'Chiquinha',
                            telefone: '+52 1234-5672',
                            foto: "./fotos/chiquinha.jpg"
                        },
                        {
                            id: 3,
                            nome: 'Sr. Barriga',
                            telefone: '+52 1234-5673',
                            foto: "./fotos/barriga.jpg"
                        }
                    ]
                }
            }

            filtrarPersonagem = (filtro) => {
                console.log('Filtrando por ', filtro, '...');
                this.setState({
                    filtro
                });
            }

            mostrarCadastro = () => {
                this.setState({
                    estaNaListagem: false
                });
            }

            mostrarListagem = () => {
                this.setState({
                    estaNaListagem: true
                });
            }

            removerItemDaLista = (id) => {
                this.setState(curState => ({
                    personagens: curState.personagens.filter(item => item.id !== id)
                }), () => {
                    console.log('Estado alterado: ', this.state);
                });
            }

            efetivarCadastro = (novaPersonagem) => {
                this.setState((curState) => ({
                    personagens: [
                        ...curState.personagens,
                        {
                            id: Math.random(),
                            ...novaPersonagem
                        }
                    ]
                }), () => {
                    this.mostrarListagem();
                });
            }

            render() {
                const { estaNaListagem, filtro, personagens } = this.state;
                const personagensFiltrados = personagens.filter(item => item.nome.indexOf(filtro) >= 0);
                return estaNaListagem ? <div><InputComAcao classeAcao={"adicionar-contato"} aoAlterar={this.filtrarPersonagem} aoAcao={this.mostrarCadastro} />
                    <Lista itens={personagensFiltrados} aoRemoverAlgumItem={this.removerItemDaLista} /></div>
                    : <FormularioCadastro aoVoltar={this.mostrarListagem} aoCadastrar={this.efetivarCadastro} />;
            }
        }

        ReactDOM.render(<App />,
            document.getElementById('container'));

    </script>


</body>

</html>